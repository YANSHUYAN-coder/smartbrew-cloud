# éœ€è¦å­˜å…¥ Redis çš„æ•°æ®æ¸…å•

## ğŸ“Š ç¼“å­˜ç­–ç•¥åˆ†æ

æ ¹æ®æŸ¥è¯¢é¢‘ç‡ã€æ•°æ®å˜åŒ–é¢‘ç‡å’Œä¸šåŠ¡é‡è¦æ€§ï¼Œä»¥ä¸‹æ˜¯éœ€è¦ç¼“å­˜çš„æ•°æ®ï¼š

---

## â­â­â­ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰

### 1. åˆ†ç±»æ•°æ®ï¼ˆCategoryï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âœ… æŸ¥è¯¢é¢‘ç‡æé«˜ï¼ˆæ¯ä¸ªç”¨æˆ·æ‰“å¼€èœå•é¡µéƒ½ä¼šæŸ¥è¯¢ï¼‰
- âœ… æ•°æ®å˜åŒ–å¾ˆå°‘ï¼ˆåˆ†ç±»ä¸ä¼šé¢‘ç¹ä¿®æ”¹ï¼‰
- âœ… æ•°æ®é‡å°ï¼ˆé€šå¸¸åªæœ‰å‡ åä¸ªåˆ†ç±»ï¼‰

**å®ç°ï¼š**

```java
@Service
public class CategoryServiceImpl extends ServiceImpl<CategoryMapper, Category> implements CategoryService {
    
    // âœ… ç¼“å­˜å¯ç”¨çš„åˆ†ç±»åˆ—è¡¨ï¼ˆæœ€å¸¸ç”¨ï¼‰
    @Cacheable(value = CacheKeyConstants.Category.ENABLED, key = "'all'")
    @Override
    public List<Category> getEnabledCategories() {
        return this.list(new LambdaQueryWrapper<Category>()
                .eq(Category::getStatus, 1)
                .orderByDesc(Category::getSort));
    }
    
    // âœ… æ›´æ–°æ—¶æ¸…é™¤ç¼“å­˜
    @CacheEvict(value = CacheKeyConstants.Category.ENABLED, allEntries = true)
    @Override
    public boolean updateById(Category entity) {
        return super.updateById(entity);
    }
    
    @CacheEvict(value = CacheKeyConstants.Category.ENABLED, allEntries = true)
    @Override
    public boolean save(Category entity) {
        return super.save(entity);
    }
}
```

**ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š** å»ºè®® 1-2 å°æ—¶ï¼ˆåˆ†ç±»æ•°æ®å˜åŒ–å°‘ï¼‰

---

### 2. èœå•æ•°æ®ï¼ˆMenuVOï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âœ… æŸ¥è¯¢é¢‘ç‡æé«˜ï¼ˆç‚¹å•é¡µçš„æ ¸å¿ƒæ•°æ®ï¼‰
- âœ… æ•°æ®é‡å¤§ï¼ˆåŒ…å«æ‰€æœ‰å•†å“å’Œåˆ†ç±»ï¼‰
- âœ… æ•°æ®å˜åŒ–è¾ƒå°‘ï¼ˆå•†å“ä¸Šæ¶/ä¸‹æ¶æ‰ä¼šå˜åŒ–ï¼‰

**å®ç°ï¼š**

```java
@Service
public class ProductServiceImpl {
    
    // âœ… ç¼“å­˜èœå•æ•°æ®ï¼ˆåŒ…å«åˆ†ç±»å’Œå•†å“ï¼‰
    @Cacheable(value = CacheKeyConstants.Product.MENU, key = "'menu'")
    @Override
    public MenuVO getMenuVO() {
        // 1. æŸ¥è¯¢æ‰€æœ‰ä¸Šæ¶å•†å“
        List<Product> allProducts = this.list(new LambdaQueryWrapper<Product>()
                .eq(Product::getStatus, 1)
                .orderByDesc(Product::getSales));
        
        // 2. æŸ¥è¯¢æ‰€æœ‰å¯ç”¨çš„åˆ†ç±»
        List<Category> categories = categoryService.getEnabledCategories();
        
        // 3. æ„å»ºè¿”å›å¯¹è±¡
        // ...
        return menuVO;
    }
    
    // âœ… å•†å“æ›´æ–°æ—¶æ¸…é™¤èœå•ç¼“å­˜
    @CacheEvict(value = CacheKeyConstants.Product.MENU, allEntries = true)
    @Override
    public boolean updateById(Product entity) {
        return super.updateById(entity);
    }
    
    @CacheEvict(value = CacheKeyConstants.Product.MENU, allEntries = true)
    @Override
    public boolean save(Product entity) {
        return super.save(entity);
    }
}
```

**ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š** å»ºè®® 15-30 åˆ†é’Ÿï¼ˆå•†å“å¯èƒ½é¢‘ç¹å˜åŒ–ï¼‰

---

### 3. å•†å“è¯¦æƒ…ï¼ˆProduct Detailï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âœ… æŸ¥è¯¢é¢‘ç‡é«˜ï¼ˆå•†å“è¯¦æƒ…é¡µï¼‰
- âœ… æ•°æ®å˜åŒ–å°‘ï¼ˆå•†å“ä¿¡æ¯ä¸ä¼šé¢‘ç¹ä¿®æ”¹ï¼‰
- âœ… æå‡ç”¨æˆ·ä½“éªŒï¼ˆè¯¦æƒ…é¡µåŠ è½½é€Ÿåº¦ï¼‰

**å®ç°ï¼š**

```java
@Service
public class ProductServiceImpl {
    
    // âœ… ç¼“å­˜å•†å“è¯¦æƒ…
    @Cacheable(value = CacheKeyConstants.Product.DETAIL, key = "#id")
    @Override
    public ProductDTO getDetail(Long id) {
        // æŸ¥è¯¢å•†å“è¯¦æƒ…é€»è¾‘
        // ...
    }
    
    // âœ… æ›´æ–°æ—¶æ¸…é™¤å¯¹åº”å•†å“çš„ç¼“å­˜
    @CacheEvict(value = CacheKeyConstants.Product.DETAIL, key = "#entity.id")
    @Override
    public boolean updateById(Product entity) {
        return super.updateById(entity);
    }
}
```

**ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š** å»ºè®® 30-60 åˆ†é’Ÿ

---

## â­â­ ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®æ–½ï¼‰

### 4. å•†å“åˆ—è¡¨ï¼ˆProduct Listï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âœ… æŸ¥è¯¢é¢‘ç‡é«˜ï¼ˆå•†å“åˆ—è¡¨é¡µã€æœç´¢é¡µï¼‰
- âš ï¸ å‚æ•°ç»„åˆå¤šï¼ˆåˆ†é¡µã€ç­›é€‰æ¡ä»¶ï¼‰ï¼Œç¼“å­˜å‘½ä¸­ç‡å¯èƒ½è¾ƒä½
- âš ï¸ æ•°æ®å¯èƒ½é¢‘ç¹å˜åŒ–ï¼ˆå•†å“ä¸Šæ¶/ä¸‹æ¶ï¼‰

**å®ç°ï¼š**

```java
@Service
public class ProductServiceImpl {
    
    // âœ… ç¼“å­˜å•†å“åˆ—è¡¨ï¼ˆä½¿ç”¨ KeyGenerator å¤„ç†å¤æ‚å‚æ•°ï¼‰
    @Cacheable(value = CacheKeyConstants.Product.LIST, keyGenerator = "cacheKeyGenerator")
    @Override
    public Page<Product> getList(PageParam pageParam) {
        // åŸæœ‰æŸ¥è¯¢é€»è¾‘
        // ...
    }
    
    // âœ… å•†å“æ›´æ–°æ—¶æ¸…é™¤åˆ—è¡¨ç¼“å­˜
    @CacheEvict(value = CacheKeyConstants.Product.LIST, allEntries = true)
    @Override
    public boolean updateById(Product entity) {
        return super.updateById(entity);
    }
}
```

**ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š** å»ºè®® 10-15 åˆ†é’Ÿï¼ˆæ•°æ®å˜åŒ–è¾ƒé¢‘ç¹ï¼‰

**æ³¨æ„ï¼š** å¦‚æœç­›é€‰æ¡ä»¶å¾ˆå¤šï¼Œç¼“å­˜å‘½ä¸­ç‡å¯èƒ½ä¸é«˜ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚

---

### 5. ç”¨æˆ·ä¿¡æ¯ï¼ˆUser Infoï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âœ… æŸ¥è¯¢é¢‘ç‡ä¸­ç­‰ï¼ˆä¸ªäººä¸­å¿ƒã€è®¢å•é¡µç­‰ï¼‰
- âœ… æ•°æ®å˜åŒ–å°‘ï¼ˆç”¨æˆ·ä¿¡æ¯ä¸ä¼šé¢‘ç¹ä¿®æ”¹ï¼‰
- âš ï¸ éœ€è¦æŒ‰ç”¨æˆ·IDç¼“å­˜ï¼ˆæ¯ä¸ªç”¨æˆ·ä¸åŒï¼‰

**å®ç°ï¼š**

```java
@Service
public class UmsMemberServiceImpl {
    
    // âœ… ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
    @Cacheable(value = CacheKeyConstants.User.INFO, key = "#userId")
    public UmsMember getUserInfo(Long userId) {
        return this.getById(userId);
    }
    
    // âœ… æ›´æ–°æ—¶æ¸…é™¤å¯¹åº”ç”¨æˆ·çš„ç¼“å­˜
    @CacheEvict(value = CacheKeyConstants.User.INFO, key = "#entity.id")
    @Override
    public boolean updateById(UmsMember entity) {
        return super.updateById(entity);
    }
}
```

**ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š** å»ºè®® 30-60 åˆ†é’Ÿ

---

## â­ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰

### 6. ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ï¼ˆUser Statisticsï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âš ï¸ åŒ…å«å®æ—¶æ•°æ®ï¼ˆè®¢å•ç»Ÿè®¡ï¼‰ï¼Œç¼“å­˜å¯èƒ½å¯¼è‡´æ•°æ®ä¸å‡†ç¡®
- âš ï¸ æŸ¥è¯¢é¢‘ç‡ä¸­ç­‰
- âœ… å¯ä»¥ç¼“å­˜ï¼Œä½†è¿‡æœŸæ—¶é—´è¦çŸ­

**å®ç°ï¼š**

```java
@Service
public class UmsMemberServiceImpl {
    
    // âš ï¸ æ³¨æ„ï¼šç»Ÿè®¡ä¿¡æ¯åŒ…å«å®æ—¶æ•°æ®ï¼Œç¼“å­˜æ—¶é—´è¦çŸ­
    @Cacheable(value = CacheKeyConstants.User.STATISTICS, key = "#userId", 
               condition = "#userId != null")
    @Override
    public Map<String, Object> getProfileStatistics(Long userId) {
        // ç»Ÿè®¡é€»è¾‘
        // ...
    }
    
    // âœ… è®¢å•çŠ¶æ€å˜åŒ–æ—¶æ¸…é™¤ç»Ÿè®¡ç¼“å­˜
    @CacheEvict(value = CacheKeyConstants.User.STATISTICS, key = "#order.memberId")
    public void onOrderStatusChanged(OmsOrder order) {
        // è®¢å•çŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨
    }
}
```

**ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š** å»ºè®® 5-10 åˆ†é’Ÿï¼ˆå®æ—¶æ€§è¦æ±‚é«˜ï¼‰

---

### 7. è®¢å•è¯¦æƒ…ï¼ˆOrder Detailï¼‰

**ç¼“å­˜åŸå› ï¼š**
- âš ï¸ æŸ¥è¯¢é¢‘ç‡ä¸­ç­‰
- âš ï¸ æ•°æ®å˜åŒ–é¢‘ç¹ï¼ˆè®¢å•çŠ¶æ€ä¼šå˜åŒ–ï¼‰
- âš ï¸ å®æ—¶æ€§è¦æ±‚é«˜

**å»ºè®®ï¼š** ä¸ç¼“å­˜ï¼Œæˆ–ç¼“å­˜æ—¶é—´å¾ˆçŸ­ï¼ˆ1-2 åˆ†é’Ÿï¼‰

---

## ğŸ“‹ å®æ–½ä¼˜å…ˆçº§æ€»ç»“

| æ•°æ® | ä¼˜å…ˆçº§ | ç¼“å­˜è¿‡æœŸæ—¶é—´ | å®æ–½éš¾åº¦ |
|------|--------|-------------|---------|
| åˆ†ç±»æ•°æ® | â­â­â­ | 1-2 å°æ—¶ | ç®€å• |
| èœå•æ•°æ® | â­â­â­ | 15-30 åˆ†é’Ÿ | ç®€å• |
| å•†å“è¯¦æƒ… | â­â­â­ | 30-60 åˆ†é’Ÿ | ç®€å• |
| å•†å“åˆ—è¡¨ | â­â­ | 10-15 åˆ†é’Ÿ | ä¸­ç­‰ |
| ç”¨æˆ·ä¿¡æ¯ | â­â­ | 30-60 åˆ†é’Ÿ | ç®€å• |
| ç”¨æˆ·ç»Ÿè®¡ | â­ | 5-10 åˆ†é’Ÿ | ä¸­ç­‰ |
| è®¢å•è¯¦æƒ… | âŒ | - | - |

---

## ğŸ¯ æ¨èå®æ–½é¡ºåº

### ç¬¬ä¸€é˜¶æ®µï¼ˆç«‹å³å®æ–½ï¼Œæ•ˆæœæœ€æ˜æ˜¾ï¼‰

1. âœ… **åˆ†ç±»æ•°æ®ç¼“å­˜** - æœ€ç®€å•ï¼Œæ•ˆæœæœ€æ˜æ˜¾
2. âœ… **èœå•æ•°æ®ç¼“å­˜** - é«˜é¢‘æŸ¥è¯¢ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
3. âœ… **å•†å“è¯¦æƒ…ç¼“å­˜** - ç®€å•ï¼Œæ•ˆæœæ˜æ˜¾

### ç¬¬äºŒé˜¶æ®µï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼‰

4. âœ… **å•†å“åˆ—è¡¨ç¼“å­˜** - å¦‚æœç­›é€‰æ¡ä»¶ä¸å¤šï¼Œæ•ˆæœæ˜æ˜¾
5. âœ… **ç”¨æˆ·ä¿¡æ¯ç¼“å­˜** - å¦‚æœç”¨æˆ·é‡å¤§ï¼Œæ•ˆæœæ˜æ˜¾

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¼“å­˜ä¸€è‡´æ€§

**é—®é¢˜ï¼š** æ›´æ–°æ•°æ®æ—¶ï¼Œç¼“å­˜å¯èƒ½è¿‡æœŸï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´

**è§£å†³ï¼š** ä½¿ç”¨ `@CacheEvict` åœ¨æ›´æ–°æ—¶æ¸…é™¤ç›¸å…³ç¼“å­˜

```java
// âœ… æ­£ç¡®ï¼šæ›´æ–°æ—¶æ¸…é™¤ç¼“å­˜
@CacheEvict(value = {"product:list", "product:detail", "product:menu"}, allEntries = true)
public boolean update(ProductDTO dto) {
    // æ›´æ–°é€»è¾‘
}
```

### 2. ç¼“å­˜ç©¿é€

**é—®é¢˜ï¼š** æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“

**è§£å†³ï¼š** ç¼“å­˜ null å€¼ï¼ˆä½†å½“å‰é…ç½®å·²ç¦ç”¨ï¼Œéœ€è¦è°ƒæ•´ï¼‰

```java
// å¦‚æœéœ€è¦é˜²æ­¢ç¼“å­˜ç©¿é€ï¼Œå¯ä»¥ç¼“å­˜ null å€¼
RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
    .entryTtl(Duration.ofMinutes(30))
    // .disableCachingNullValues(); // æ³¨é‡Šæ‰è¿™è¡Œï¼Œå…è®¸ç¼“å­˜ null
```

### 3. ç¼“å­˜é›ªå´©

**é—®é¢˜ï¼š** å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›å¤§

**è§£å†³ï¼š** è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´

```java
// å¯ä»¥è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ï¼ˆ5-10åˆ†é’Ÿéšæœºï¼‰
.entryTtl(Duration.ofMinutes(5 + new Random().nextInt(5)))
```

### 4. çƒ­ç‚¹æ•°æ®

**é—®é¢˜ï¼š** æŸäº›æ•°æ®è®¿é—®é‡ç‰¹åˆ«å¤§

**è§£å†³ï¼š** è®¾ç½®æ›´é•¿çš„è¿‡æœŸæ—¶é—´ï¼Œæˆ–ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰

---

## ğŸ“ å®Œæ•´å®ç°ç¤ºä¾‹

### CategoryServiceImplï¼ˆåˆ†ç±»æœåŠ¡ï¼‰

```java
@Service
public class CategoryServiceImpl extends ServiceImpl<CategoryMapper, Category> implements CategoryService {
    
    @Cacheable(value = CacheKeyConstants.Category.ENABLED, key = "'all'")
    @Override
    public List<Category> getEnabledCategories() {
        return this.list(new LambdaQueryWrapper<Category>()
                .eq(Category::getStatus, 1)
                .orderByDesc(Category::getSort));
    }
    
    @CacheEvict(value = CacheKeyConstants.Category.ENABLED, allEntries = true)
    @Override
    public boolean updateById(Category entity) {
        return super.updateById(entity);
    }
    
    @CacheEvict(value = CacheKeyConstants.Category.ENABLED, allEntries = true)
    @Override
    public boolean save(Category entity) {
        return super.save(entity);
    }
    
    @CacheEvict(value = CacheKeyConstants.Category.ENABLED, allEntries = true)
    @Override
    public boolean removeById(Serializable id) {
        return super.removeById(id);
    }
}
```

### ProductServiceImplï¼ˆå•†å“æœåŠ¡ï¼‰

```java
@Service
public class ProductServiceImpl extends ServiceImpl<ProductMapper, Product> implements ProductService {
    
    // èœå•æ•°æ®ç¼“å­˜
    @Cacheable(value = CacheKeyConstants.Product.MENU, key = "'menu'")
    @Override
    public MenuVO getMenuVO() {
        // åŸæœ‰é€»è¾‘
    }
    
    // å•†å“è¯¦æƒ…ç¼“å­˜
    @Cacheable(value = CacheKeyConstants.Product.DETAIL, key = "#id")
    @Override
    public ProductDTO getDetail(Long id) {
        // åŸæœ‰é€»è¾‘
    }
    
    // å•†å“åˆ—è¡¨ç¼“å­˜ï¼ˆå¯é€‰ï¼Œæ ¹æ®å®é™…æƒ…å†µï¼‰
    @Cacheable(value = CacheKeyConstants.Product.LIST, keyGenerator = "cacheKeyGenerator")
    @Override
    public Page<Product> getList(PageParam pageParam) {
        // åŸæœ‰é€»è¾‘
    }
    
    // æ›´æ–°æ—¶æ¸…é™¤æ‰€æœ‰ç›¸å…³ç¼“å­˜
    @CacheEvict(value = {
        CacheKeyConstants.Product.MENU,
        CacheKeyConstants.Product.DETAIL,
        CacheKeyConstants.Product.LIST
    }, allEntries = true)
    @Override
    public boolean updateById(Product entity) {
        return super.updateById(entity);
    }
    
    @CacheEvict(value = {
        CacheKeyConstants.Product.MENU,
        CacheKeyConstants.Product.LIST
    }, allEntries = true)
    @Override
    public boolean save(Product entity) {
        return super.save(entity);
    }
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ç¼“å­˜æ³¨è§£åˆ°åˆ†ç±»æœåŠ¡ï¼ˆæœ€ç®€å•ï¼‰

åœ¨ `CategoryServiceImpl.getEnabledCategories()` æ–¹æ³•ä¸Šæ·»åŠ  `@Cacheable` æ³¨è§£ï¼Œç«‹å³ç”Ÿæ•ˆï¼

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ ç¼“å­˜æ³¨è§£åˆ°èœå•æœåŠ¡

åœ¨ `ProductServiceImpl.getMenuVO()` æ–¹æ³•ä¸Šæ·»åŠ  `@Cacheable` æ³¨è§£ã€‚

### ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•éªŒè¯

1. ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼šä»æ•°æ®åº“æŸ¥è¯¢ï¼Œå†™å…¥ç¼“å­˜
2. ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼šä»ç¼“å­˜è¯»å–ï¼Œé€Ÿåº¦æ˜æ˜¾æå‡
3. æ›´æ–°æ•°æ®ï¼šç¼“å­˜è‡ªåŠ¨æ¸…é™¤
4. å†æ¬¡æŸ¥è¯¢ï¼šé‡æ–°ä»æ•°æ®åº“æŸ¥è¯¢å¹¶ç¼“å­˜

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

| æ•°æ® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| åˆ†ç±»æŸ¥è¯¢ | 10-20ms | 1-2ms | 80-90% â†“ |
| èœå•æŸ¥è¯¢ | 50-100ms | 2-5ms | 90-95% â†“ |
| å•†å“è¯¦æƒ… | 15-30ms | 1-3ms | 80-90% â†“ |

