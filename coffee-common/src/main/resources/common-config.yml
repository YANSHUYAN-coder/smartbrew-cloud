# coffee-common/src/main/resources/common-config.yml

server:
  servlet:
    context-path: /api  # App和Admin都使用 /api 前缀

spring:
  # 1. 激活 AI 配置 (App和Admin都需要)
  profiles:
    include: ai

  # 2. 数据库配置 (共用)
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/coffee_cloud?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    username: root
    password: 123456

  # 3. RabbitMQ 配置 (共用)
  rabbitmq:
    host: 192.168.14.130
    port: 5672
    username: admin
    password: 12345678
    # 【新增】生产者发布确认：确保消息到达交换机 (Exchange)
    publisher-confirm-type: correlated
    # 【新增】生产者回退机制：确保消息从交换机到达队列 (Queue)
    publisher-returns: true
    template:
      # 【新增】强制投递：如果消息无法路由到队列，会退回给生产者（而不是直接丢弃）
      mandatory: true
    listener:
      simple:
        # 【保持】消费者手动确认：确保业务逻辑执行成功后再告诉 MQ
        acknowledge-mode: manual
        # 预取数量：控制消费者一次拉取多少条（防止一次拉太多处理不过来）
        prefetch: 1
        retry:
          enabled: true
          # 最大重试次数：3次（包含第1次调用，即：1次正常 + 2次重试）
          max-attempts: 3
          # 初始间隔：1000ms (1秒)
          initial-interval: 1000ms
          # 间隔倍数：每次重试间隔 * 2 (例如：1s -> 2s -> 4s)
          multiplier: 2
          # 最大间隔：10秒 (防止倍数乘得太大)
          max-interval: 10000ms

# 4. MinIO 配置
minio:
  endpoint: http://192.168.14.130:9000
  access-key: admin
  secret-key: 12345678
  bucket-name: coffee-bucket

# 5. MyBatis Plus 配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true

# 6. 日志配置 (统一日志格式)
logging:
  level:
    com.coffee: debug
    org.springframework.ai: debug
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n"

# 7. 高德地图
amap:
  key: f5ca3cdf9f9acf90ac8fa849446a0f15

# 8. 沙箱支付 (App和Admin公用一套Key)
alipay:
  gateway-url: https://openapi-sandbox.dl.alipaydev.com/gateway.do
  app-id: 9021000151646402
  merchant-private-key: MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDnnIVPYpdzvjP7AvTn8ZnG1aBYHIn0icjYSktrqpHlPkfk8nLSqesxeVW2i+KaK9yz5JNrszK6g3h4P6dosoHuyF9H3NjNPcjWtBJwNOEJphy7CKAuo4AK11hcejrGRdfELRJpsv4qojeQiIlQNkdhZ4dRK0D7ODZB9cMJoYL2L/35mw7N94uNslZ3mCjF2PFSwjBg3qNB7Doyls/S//LukeP+6BVHLZsvk2h3NLjGPRx9NRz5S/MCv0jrq5ZB2SmGsPgMVA0YEIdw9vIomDg7/VB1yADqD/qWLcPvQUw51KE5pKmFyVJci86PFGdx9thABWWx9et7/skexPhr8UA3AgMBAAECggEACkJlqVGNsePP+6Ny479Q93zJAH4rIjjkO6h21MsWcVgj6SFQMsKyF1vvjwl9PSUKPrG2UgP7EEX4lSMEsF+P39riVZWTyOuetNv/IRdGjJ3eEe7c4ZP+fPxy/o2vgs7fMuJoOWRjW9IZsf5KTtJIsSjb1p2a4EXqKVvQiuGromoCOE1ivJR4bMHAijrZt85HBX5empL3exQSv5NJ5muL93RWn8/tL6yJWeAS8JvXMBXWlG0GfUBovalLswARbSMBH8kiyjQsK57uXKjUHV5Qm1BC3SnJJcWrPlb5w+VHoUiwArPvTR0rkkPI6jNwZ70xgjyIxRSAd6Twpbvlztm14QKBgQD9Mgs1gw/Avo9z8b1PT8DU0lSxWwRf05d2idpKeyFEDOqLxj2KIY0NQLg+eJbEFdDJ8uCfYkXPP5Vi2TDrYHbcJ7O5P68dE3nRPqajopq/zZh7GQ5O9ktyOWYUDPL6xtLYT3G929PjyC/Uc0uD59lULdvcKH/uXIxQD1SNWnPDMQKBgQDqLUYI6lMzYEXHoM4ROWxuW3Gh3FsCFQoWUbHllA+A2VZiWWwb5KjXcVT2nGYQj+F2DjNtx8yOSH7gfY5LiOWWDb+Nsdbnvy2vcUK/B5VqLZb+rvHAzmTDRNzXlBUKPAo5fgBNXkE11qSJf32Gk8NH+rOLr/k/ViyESduDyEBP5wKBgEuFjcpcWWqIbImM5YaupznTsudj2p4qotb8r1vf9kAyChO/AcQd1dDKKSqZFX9PcoOKKm3gBiqXMJvXZLwQfeOVBAqRcE4f7Qn4wgO1EKt9S6oMAzSSSla7wDLi2ebrPyC+MZML6tvabknUSgYCNdTiCN5WRjJ28HNA31t6S2VBAoGADivbNyLnEg7bai9DCSvOcgc6oy7wmvmm+J7NAzWokoWUgrMipbV6uj7zg1EHpCzw2fIWDqiuqlWcx/0RJWUNb705QFvow3GAVEOoZGMTGa/UmWkA3EghNOfv7WPauhnUDJKhdg0kKRvqLR/3+rLqeGqlfuiRTtHqM788d4cgzTUCgYEAwRbdOZ4eO5uf2TbuyiyKPSF6+Z3llC5sepQzDPffkEzLQxELvaCQOW2mjKFydDr4zGYp3CDmJkCgdo/kngIVDQDNRPOAofcoe9q6Jv134sNBdLf2fq97YqJqSERipKEr5Ip72nf5C4Pwnz1q7e8H9ksL1IxktmjKbPVAaHxmVcA=
  alipay-public-key: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1IwOy71oGV6G95/ynQyhAJamEaBH9BIA9PErbDqh7Xy7jMEAU6eHZpOi/d4elI2OxhHhMM+ngxSnbxKxfl21pEz6y6dEm1obw8QbmaG57f3R3JNoLGefrmvgUFce5q1ERf5Cq66YIEbXML6RcNrlYjRrT/Ha/my9+BESI4BQw43MqmI34+PqWAhVMsFJ6E3pFrgxox8KmQxYVt0Bjd53kpEmbneKXMxPcFDB3eI7M3d66T4pgJGC4Y47DnQh2JANo6gbtCAKi2VICqoz2yf9lNkW/J+78Q9P6htJ+V9EsIphJKAa6M7P2beWgNc5qj2HGD/99BZeZUNF7Z5qdNk4RQIDAQAB
  notify-url: https://7403d6f0.r36.cpolar.top/api/app/pay/notify
  charset: UTF-8
  format: json
  sign-type: RSA2