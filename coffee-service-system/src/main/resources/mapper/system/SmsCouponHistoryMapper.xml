<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coffee.system.mapper.SmsCouponHistoryMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.coffee.system.domain.entity.SmsCouponHistory">
        <id column="id" property="id" />
        <result column="coupon_id" property="couponId" />
        <result column="member_id" property="memberId" />
        <result column="coupon_code" property="couponCode" />
        <result column="member_nickname" property="memberNickname" />
        <result column="get_type" property="getType" />
        <result column="use_status" property="useStatus" />
        <result column="use_time" property="useTime" />
        <result column="order_id" property="orderId" />
        <result column="order_sn" property="orderSn" />
        <result column="create_time" property="createTime" />
        <result column="create_by" property="createBy" />
        <result column="update_time" property="updateTime" />
        <result column="update_by" property="updateBy" />
        <result column="remark" property="remark" />
    </resultMap>

    <select id="selectMemberCouponsWithDetail" resultType="com.coffee.system.domain.vo.CouponHistoryVO">
        SELECT 
            h.id,
            h.coupon_id,
            h.member_id,
            h.coupon_code,
            h.member_nickname,
            h.get_type,
            h.use_status,
            h.use_time,
            h.order_id,
            h.order_sn,
            h.create_time,
            h.expire_time,
            c.name as coupon_name, 
            c.amount, 
            c.min_point, 
            c.start_time, 
            c.end_time, 
            c.note
        FROM sms_coupon_history h
        LEFT JOIN sms_coupon c ON h.coupon_id = c.id
        WHERE h.member_id = #{memberId}
        <if test="useStatus != null">
            AND h.use_status = #{useStatus}
        </if>
        ORDER BY h.create_time DESC
    </select>

</mapper>

